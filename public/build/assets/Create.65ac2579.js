import{G as ue,aN as ie,J as ce,B as w,k as _,L as p,M as f,b2 as de,S as j,O as pe,aP as me,T as xe,r as i,o as E,e as ge,f as r,w as o,h as S,u as e,l as M,m as I,i as b,t as $,j as q,x as _e,U as fe,F as ye}from"./vendor.d12b5734.js";import{u as ve}from"./expense.59b7c404.js";import{u as Ee}from"./category.997da6bd.js";import{l as be,b as $e,m as he,c as Be,d as Ce}from"./main.94931a0e.js";import{_ as Ve}from"./CreateCustomFields.bf400434.js";import{_ as we}from"./CategoryModal.ab6e0625.js";import{_ as Se}from"./ExchangeRateConverter.6b3bf01f.js";import"./exchange-rate.5f3eeb90.js";const Me=["onSubmit"],Ie={class:"hidden md:block"},qe={class:"block md:hidden"},Te={setup(ke){const D=be(),k=$e(),n=ve(),P=Ee(),N=he(),G=Be(),g=ue(),T=ie(),{t:c}=ce(),F=Ce();let m=w(!1),u=w(!1);const U="newExpense",h=w(!1),A=_(()=>({currentExpense:{expense_category_id:{required:p.withMessage(c("validation.required"),f)},expense_date:{required:p.withMessage(c("validation.required"),f)},amount:{required:p.withMessage(c("validation.required"),f),minValue:p.withMessage(c("validation.price_minvalue"),de(.1)),maxLength:p.withMessage(c("validation.price_maxlength"),j(20))},notes:{maxLength:p.withMessage(c("validation.description_maxlength"),j(65e3))},currency_id:{required:p.withMessage(c("validation.required"),f)},exchange_rate:{required:pe(function(){return p.withMessage(c("validation.required"),f),n.showExchangeRate}),decimal:p.withMessage(c("validation.valid_exchange_rate"),me)}}})),l=xe(A,n,{$scope:U}),B=_({get:()=>n.currentExpense.amount/100,set:t=>{n.currentExpense.amount=Math.round(t*100)}}),d=_(()=>g.name==="expenses.edit"),R=_(()=>d.value?c("expenses.edit_expense"):c("expenses.new_expense")),L=_(()=>d.value?`/reports/expenses/${g.params.id}/download-receipt`:"");n.resetCurrentExpenseData(),N.resetCustomFields(),W();function z(t,a){n.currentExpense.attachment_receipt=a}function H(){n.currentExpense.attachment_receipt=null,h.value=!0}function J(){G.openModal({title:c("settings.expense_category.add_category"),componentName:"CategoryModal",size:"sm"})}function O(t){n.currentExpense.selectedCurrency=F.currencies.find(a=>a.id===t)}async function K(t){return(await P.fetchCategories({search:t})).data.data}async function Q(t){return(await D.fetchCustomers({search:t})).data.data}async function W(){d.value||(n.currentExpense.currency_id=k.selectedCompanyCurrency.id,n.currentExpense.selectedCurrency=k.selectedCompanyCurrency),u.value=!0,await n.fetchPaymentModes({limit:"all"}),d.value?(await n.fetchExpense(g.params.id),n.currentExpense.currency_id=n.currentExpense.selectedCurrency.id):g.query.customer&&(n.currentExpense.customer_id=g.query.customer),u.value=!1}async function X(){if(l.value.$touch(),l.value.$invalid)return;m.value=!0;let t=n.currentExpense;try{d.value?await n.updateExpense({id:g.params.id,data:t,isAttachmentReceiptRemoved:h.value}):await n.addExpense(t),m.value=!1,n.currentExpense.attachment_receipt=null,h.value=!1,T.push("/admin/expenses")}catch(a){console.error(a),m.value=!1;return}}return(t,a)=>{const C=i("BaseBreadcrumbItem"),Y=i("BaseBreadcrumb"),y=i("BaseIcon"),V=i("BaseButton"),Z=i("BasePageHeader"),ee=i("BaseSelectAction"),v=i("BaseMultiselect"),x=i("BaseInputGroup"),ne=i("BaseDatePicker"),te=i("BaseMoney"),ae=i("BaseTextarea"),re=i("BaseFileUploader"),se=i("BaseInputGrid"),oe=i("BaseCard"),le=i("BasePage");return E(),ge(ye,null,[r(we),r(le,{class:"relative"},{default:o(()=>[S("form",{action:"",onSubmit:fe(X,["prevent"])},[r(Z,{title:e(R),class:"mb-5"},{actions:o(()=>[e(d)&&e(n).currentExpense.attachment_receipt_url?(E(),M(V,{key:0,href:e(L),tag:"a",variant:"primary-outline",type:"button",class:"mr-2"},{left:o(s=>[r(y,{name:"DownloadIcon",class:I(s.class)},null,8,["class"])]),default:o(()=>[b(" "+$(t.$t("expenses.download_receipt")),1)]),_:1},8,["href"])):q("",!0),S("div",Ie,[r(V,{loading:e(m),"content-loading":e(u),disabled:e(m),variant:"primary",type:"submit"},{left:o(s=>[e(m)?q("",!0):(E(),M(y,{key:0,name:"SaveIcon",class:I(s.class)},null,8,["class"]))]),default:o(()=>[b(" "+$(e(d)?t.$t("expenses.update_expense"):t.$t("expenses.save_expense")),1)]),_:1},8,["loading","content-loading","disabled"])])]),default:o(()=>[r(Y,null,{default:o(()=>[r(C,{title:t.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),r(C,{title:t.$tc("expenses.expense",2),to:"/admin/expenses"},null,8,["title"]),r(C,{title:e(R),to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),r(oe,null,{default:o(()=>[r(se,null,{default:o(()=>[r(x,{label:t.$t("expenses.category"),error:e(l).currentExpense.expense_category_id.$error&&e(l).currentExpense.expense_category_id.$errors[0].$message,"content-loading":e(u),required:""},{default:o(()=>[r(v,{modelValue:e(n).currentExpense.expense_category_id,"onUpdate:modelValue":a[0]||(a[0]=s=>e(n).currentExpense.expense_category_id=s),"content-loading":e(u),"value-prop":"id",label:"name","track-by":"id",options:K,"filter-results":!1,"resolve-on-load":"",delay:500,searchable:"",invalid:e(l).currentExpense.expense_category_id.$error,placeholder:t.$t("expenses.categories.select_a_category"),onInput:a[1]||(a[1]=s=>e(l).currentExpense.expense_category_id.$touch())},{action:o(()=>[r(ee,{onClick:J},{default:o(()=>[r(y,{name:"PlusIcon",class:"h-4 mr-2 -ml-2 text-center text-primary-400"}),b(" "+$(t.$t("settings.expense_category.add_new_category")),1)]),_:1})]),_:1},8,["modelValue","content-loading","invalid","placeholder"])]),_:1},8,["label","error","content-loading"]),r(x,{label:t.$t("expenses.expense_date"),error:e(l).currentExpense.expense_date.$error&&e(l).currentExpense.expense_date.$errors[0].$message,"content-loading":e(u),required:""},{default:o(()=>[r(ne,{modelValue:e(n).currentExpense.expense_date,"onUpdate:modelValue":a[2]||(a[2]=s=>e(n).currentExpense.expense_date=s),"content-loading":e(u),"calendar-button":!0,invalid:e(l).currentExpense.expense_date.$error,onInput:a[3]||(a[3]=s=>e(l).currentExpense.expense_date.$touch())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","error","content-loading"]),r(x,{label:t.$t("expenses.amount"),error:e(l).currentExpense.amount.$error&&e(l).currentExpense.amount.$errors[0].$message,"content-loading":e(u),required:""},{default:o(()=>[r(te,{key:e(n).currentExpense.selectedCurrency,modelValue:e(B),"onUpdate:modelValue":a[4]||(a[4]=s=>_e(B)?B.value=s:null),class:"focus:border focus:border-solid focus:border-primary-500",invalid:e(l).currentExpense.amount.$error,currency:e(n).currentExpense.selectedCurrency,onInput:a[5]||(a[5]=s=>e(l).currentExpense.amount.$touch())},null,8,["modelValue","invalid","currency"])]),_:1},8,["label","error","content-loading"]),r(x,{label:t.$t("expenses.currency"),"content-loading":e(u),error:e(l).currentExpense.currency_id.$error&&e(l).currentExpense.currency_id.$errors[0].$message,required:""},{default:o(()=>[r(v,{modelValue:e(n).currentExpense.currency_id,"onUpdate:modelValue":[a[6]||(a[6]=s=>e(n).currentExpense.currency_id=s),O],"value-prop":"id",label:"name","track-by":"name","content-loading":e(u),options:e(F).currencies,searchable:"","can-deselect":!1,placeholder:t.$t("customers.select_currency"),invalid:e(l).currentExpense.currency_id.$error,class:"w-full"},null,8,["modelValue","content-loading","options","placeholder","invalid"])]),_:1},8,["label","content-loading","error"]),r(Se,{store:e(n),"store-prop":"currentExpense",v:e(l).currentExpense,"is-loading":e(u),"is-edit":e(d),"customer-currency":e(n).currentExpense.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"]),r(x,{"content-loading":e(u),label:t.$t("expenses.customer")},{default:o(()=>[r(v,{modelValue:e(n).currentExpense.customer_id,"onUpdate:modelValue":a[7]||(a[7]=s=>e(n).currentExpense.customer_id=s),"content-loading":e(u),"value-prop":"id",label:"name","track-by":"id",options:Q,"filter-results":!1,"resolve-on-load":"",delay:500,searchable:"",placeholder:t.$t("customers.select_a_customer")},null,8,["modelValue","content-loading","placeholder"])]),_:1},8,["content-loading","label"]),r(x,{"content-loading":e(u),label:t.$t("payments.payment_mode")},{default:o(()=>[r(v,{modelValue:e(n).currentExpense.payment_method_id,"onUpdate:modelValue":a[8]||(a[8]=s=>e(n).currentExpense.payment_method_id=s),"content-loading":e(u),label:"name","value-prop":"id","track-by":"name",options:e(n).paymentModes,placeholder:t.$t("payments.select_payment_mode"),searchable:""},null,8,["modelValue","content-loading","options","placeholder"])]),_:1},8,["content-loading","label"]),r(x,{"content-loading":e(u),label:t.$t("expenses.note"),error:e(l).currentExpense.notes.$error&&e(l).currentExpense.notes.$errors[0].$message},{default:o(()=>[r(ae,{modelValue:e(n).currentExpense.notes,"onUpdate:modelValue":a[9]||(a[9]=s=>e(n).currentExpense.notes=s),"content-loading":e(u),row:4,rows:"4",onInput:a[10]||(a[10]=s=>e(l).currentExpense.notes.$touch())},null,8,["modelValue","content-loading"])]),_:1},8,["content-loading","label","error"]),r(x,{label:t.$t("expenses.receipt")},{default:o(()=>[r(re,{modelValue:e(n).currentExpense.receiptFiles,"onUpdate:modelValue":a[11]||(a[11]=s=>e(n).currentExpense.receiptFiles=s),accept:"image/*,.doc,.docx,.pdf,.csv,.xlsx,.xls",onChange:z,onRemove:H},null,8,["modelValue"])]),_:1},8,["label"]),r(Ve,{"is-edit":e(d),class:"col-span-2","is-loading":e(u),type:"Expense",store:e(n),"store-prop":"currentExpense","custom-field-scope":U},null,8,["is-edit","is-loading","store"]),S("div",qe,[r(V,{loading:e(m),tabindex:6,variant:"primary",type:"submit",class:"flex justify-center w-full"},{left:o(s=>[e(m)?q("",!0):(E(),M(y,{key:0,name:"SaveIcon",class:I(s.class)},null,8,["class"]))]),default:o(()=>[b(" "+$(e(d)?t.$t("expenses.update_expense"):t.$t("expenses.save_expense")),1)]),_:1},8,["loading"])])]),_:1})]),_:1})],40,Me)]),_:1})],64)}}};export{Te as default};
