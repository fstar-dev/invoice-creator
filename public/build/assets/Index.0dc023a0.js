import{i as b,g as _e,C as ve,j as fe,k as D,aS as pe,aT as ge,r,o as I,s as B,w as s,b as a,Z as k,al as R,y as l,z as V,v as _,x as m,A as x,a5 as G,t as v,a0 as be}from"./vendor.e9042f2c.js";import{B as Ie,k as Be,i as he,u as ye,d as Ce,e as h}from"./main.d8ec3f25.js";import{_ as ke}from"./SendInvoiceModal.a2b1bc3f.js";import{_ as Re}from"./RecurringInvoiceIndexDropdown.7160d2ee.js";import{M as Ve}from"./MoonwalkerIcon.47caa882.js";const $e=v("div",{class:"hidden w-8 h-0 mx-4 border border-gray-400 border-solid xl:block",style:{"margin-top":"1.5rem"}},null,-1),Ee={class:"relative table-container"},Ae={class:"relative flex items-center justify-between h-10 mt-5 list-none border-b-2 border-gray-200 border-solid"},Ne={class:"flex text-sm font-medium cursor-pointer select-none text-primary-400"},Se={class:"absolute items-center left-6 top-2.5 select-none"},we={class:"relative block"},Te={class:"text-xs text-gray-400"},Pe={setup(De){const c=Ie();Be();const j=he(),F=ye(),$=Ce(),y=b(null),{t:i}=_e(),g=b(!1),q=b(["ACTIVE","ON_HOLD","ALL"]),E=b(!0),f=b("recurring-invoices.all");ve();let o=fe({customer_id:"",status:"ACTIVE",starts_at:"",to_date:""});const L=D(()=>!c.totalRecurringInvoices&&!E.value),A=D({get:()=>c.selectedRecurringInvoices,set:t=>c.selectRecurringInvoice(t)}),H=D(()=>[{key:"checkbox",thClass:"extra",tdClass:"font-medium text-gray-900"},{key:"starts_at",label:i("recurring_invoices.starts_at"),thClass:"extra",tdClass:"font-medium"},{key:"customer",label:i("invoices.customer")},{key:"frequency",label:i("recurring_invoices.frequency.title")},{key:"status",label:i("invoices.status")},{key:"total",label:i("invoices.total")},{key:"actions",label:i("recurring_invoices.action"),tdClass:"text-right text-sm font-medium",thClass:"text-right",sortable:!1}]);pe(o,()=>{J()},{debounce:500}),ge(()=>{c.selectAllField&&c.selectAllRecurringInvoices()});function W(){return $.hasAbilities([h.DELETE_RECURRING_INVOICE,h.EDIT_RECURRING_INVOICE,h.VIEW_RECURRING_INVOICE])}function z(t){const n=c.frequencies.find(u=>u.value===t);return n?n.label:`CUSTOM: ${t}`}function N(){y.value&&y.value.refresh()}async function X({page:t,filter:n,sort:u}){let p={customer_id:o.customer_id,status:o.status,from_date:o.from_date,to_date:o.to_date,orderByField:u.fieldName||"created_at",orderBy:u.order||"desc",page:t};E.value=!0;let d=await c.fetchRecurringInvoices(p);return E.value=!1,{data:d.data.data,pagination:{totalPages:d.data.meta.last_page,currentPage:t,totalCount:d.data.meta.total,limit:10}}}function Z(t){if(f.value==t.title)return!0;switch(f.value=t.title,t.title){case i("recurring_invoices.active"):o.status="ACTIVE";break;case i("recurring_invoices.on_hold"):o.status="ON_HOLD";break;case i("recurring_invoices.all"):o.status="ALL";break}}function J(){c.$patch(t=>{t.selectedRecurringInvoices=[],t.selectAllField=!1}),N()}function O(){o.customer="",o.status="",o.from_date="",o.to_date="",o.invoice_number="",f.value=i("general.all")}async function K(t=null){j.openDialog({title:i("general.are_you_sure"),message:i("invoices.confirm_delete"),yesLabel:i("general.ok"),noLabel:i("general.cancel"),variant:"danger",hideNoButton:!1,size:"lg"}).then(async n=>{n&&await c.deleteMultipleRecurringInvoices(t).then(u=>{u.data.success?(N(),c.$patch(p=>{p.selectedRecurringInvoices=[],p.selectAllField=!1}),F.showNotification({type:"success",message:i("recurring_invoices.deleted_message",2)})):u.data.error&&F.showNotification({type:"error",message:u.data.message})})})}function Q(){g.value&&O(),g.value=!g.value}async function Y(t,n){o.status="",N()}function ee(t){switch(t){case"ACTIVE":f.value=i("recurring_invoices.active");break;case"ON_HOLD":f.value=i("recurring_invoices.on_hold");break;case"ALL":f.value=i("recurring_invoices.all");break}}return(t,n)=>{const u=r("BaseBreadcrumbItem"),p=r("BaseBreadcrumb"),d=r("BaseIcon"),S=r("BaseButton"),U=r("router-link"),te=r("BasePageHeader"),ae=r("BaseCustomerSelectInput"),C=r("BaseInputGroup"),se=r("BaseMultiselect"),M=r("BaseDatePicker"),ne=r("BaseFilterWrapper"),oe=r("BaseEmptyPlaceholder"),w=r("BaseTab"),le=r("BaseTabGroup"),re=r("BaseDropdownItem"),ie=r("BaseDropdown"),P=r("BaseCheckbox"),ce=r("BaseRecurringInvoiceStatusBadge"),ue=r("BaseFormatMoney"),de=r("BaseTable"),me=r("BasePage");return I(),B(me,null,{default:s(()=>[a(ke),a(te,{title:t.$t("recurring_invoices.title")},{actions:s(()=>[k(a(S,{variant:"primary-outline",onClick:Q},{right:s(e=>[g.value?(I(),B(d,{key:1,name:"XIcon",class:V(e.class)},null,8,["class"])):(I(),B(d,{key:0,name:"FilterIcon",class:V(e.class)},null,8,["class"]))]),default:s(()=>[_(m(t.$t("general.filter"))+" ",1)]),_:1},512),[[R,l(c).totalRecurringInvoices]]),l($).hasAbilities(l(h).CREATE_RECURRING_INVOICE)?(I(),B(U,{key:0,to:"recurring-invoices/create"},{default:s(()=>[a(S,{variant:"primary",class:"ml-4"},{left:s(e=>[a(d,{name:"PlusIcon",class:V(e.class)},null,8,["class"])]),default:s(()=>[_(" "+m(t.$t("recurring_invoices.new_invoice")),1)]),_:1})]),_:1})):x("",!0)]),default:s(()=>[a(p,null,{default:s(()=>[a(u,{title:t.$t("general.home"),to:"dashboard"},null,8,["title"]),a(u,{title:t.$tc("recurring_invoices.invoice",2),to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),k(a(ne,{onClear:O},{default:s(()=>[a(C,{label:t.$tc("customers.customer",1)},{default:s(()=>[a(ae,{modelValue:l(o).customer_id,"onUpdate:modelValue":n[0]||(n[0]=e=>l(o).customer_id=e),placeholder:t.$t("customers.type_or_click"),"value-prop":"id",label:"name"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(C,{label:t.$t("recurring_invoices.status")},{default:s(()=>[a(se,{modelValue:l(o).status,"onUpdate:modelValue":[n[1]||(n[1]=e=>l(o).status=e),ee],options:q.value,searchable:"",placeholder:t.$t("general.select_a_status"),onRemove:n[2]||(n[2]=e=>Y())},null,8,["modelValue","options","placeholder"])]),_:1},8,["label"]),a(C,{label:t.$t("general.from")},{default:s(()=>[a(M,{modelValue:l(o).from_date,"onUpdate:modelValue":n[3]||(n[3]=e=>l(o).from_date=e),"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue"])]),_:1},8,["label"]),$e,a(C,{label:t.$t("general.to")},{default:s(()=>[a(M,{modelValue:l(o).to_date,"onUpdate:modelValue":n[4]||(n[4]=e=>l(o).to_date=e),"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},512),[[R,g.value]]),k(a(oe,{title:t.$t("recurring_invoices.no_invoices"),description:t.$t("recurring_invoices.list_of_invoices")},G({default:s(()=>[a(Ve,{class:"mt-5 mb-4"})]),_:2},[l($).hasAbilities(l(h).CREATE_RECURRING_INVOICE)?{name:"actions",fn:s(()=>[a(S,{variant:"primary-outline",onClick:n[5]||(n[5]=e=>t.$router.push("/admin/recurring-invoices/create"))},{left:s(e=>[a(d,{name:"PlusIcon",class:V(e.class)},null,8,["class"])]),default:s(()=>[_(" "+m(t.$t("recurring_invoices.add_new_invoice")),1)]),_:1})])}:void 0]),1032,["title","description"]),[[R,l(L)]]),k(v("div",Ee,[v("div",Ae,[a(le,{class:"-mb-5",onChange:Z},{default:s(()=>[a(w,{title:t.$t("recurring_invoices.active"),filter:"ACTIVE"},null,8,["title"]),a(w,{title:t.$t("recurring_invoices.on_hold"),filter:"ON_HOLD"},null,8,["title"]),a(w,{title:t.$t("recurring_invoices.all"),filter:"ALL"},null,8,["title"])]),_:1}),l(c).selectedRecurringInvoices.length?(I(),B(ie,{key:0,class:"absolute float-right"},{activator:s(()=>[v("span",Ne,[_(m(t.$t("general.actions"))+" ",1),a(d,{name:"ChevronDownIcon",class:"h-5"})])]),default:s(()=>[a(re,{onClick:n[6]||(n[6]=e=>K())},{default:s(()=>[a(d,{name:"TrashIcon",class:"mr-3 text-gray-600"}),_(" "+m(t.$t("general.delete")),1)]),_:1})]),_:1})):x("",!0)]),a(de,{ref:(e,T)=>{T.table=e,y.value=e},data:X,columns:l(H),"placeholder-count":l(c).totalRecurringInvoices>=20?10:5,class:"mt-10"},G({header:s(()=>[v("div",Se,[a(P,{modelValue:l(c).selectAllField,"onUpdate:modelValue":n[7]||(n[7]=e=>l(c).selectAllField=e),variant:"primary",onChange:l(c).selectAllRecurringInvoices},null,8,["modelValue","onChange"])])]),"cell-checkbox":s(({row:e})=>[v("div",we,[a(P,{id:e.id,modelValue:l(A),"onUpdate:modelValue":n[8]||(n[8]=T=>be(A)?A.value=T:null),value:e.data.id},null,8,["id","modelValue","value"])])]),"cell-starts_at":s(({row:e})=>[_(m(e.data.formatted_starts_at),1)]),"cell-customer":s(({row:e})=>[a(U,{to:{path:`recurring-invoices/${e.data.id}/view`},class:"font-medium text-primary-500 flex flex-col"},{default:s(()=>[_(m(e.data.customer.name)+" ",1),v("span",Te,m(e.data.customer.contact_name?e.data.customer.contact_name:""),1)]),_:2},1032,["to"])]),"cell-frequency":s(({row:e})=>[_(m(z(e.data.frequency)),1)]),"cell-status":s(({row:e})=>[a(ce,{status:e.data.status,class:"px-3 py-1"},{default:s(()=>[_(m(e.data.status),1)]),_:2},1032,["status"])]),"cell-total":s(({row:e})=>[a(ue,{amount:e.data.total,currency:e.data.customer.currency},null,8,["amount","currency"])]),_:2},[W?{name:"cell-actions",fn:s(({row:e})=>[a(Re,{row:e.data,table:y.value},null,8,["row","table"])])}:void 0]),1032,["columns","placeholder-count"])],512),[[R,!l(L)]])]),_:1})}}};export{Pe as default};
